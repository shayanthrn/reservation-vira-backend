<!DOCTYPE html>
<html lang="fa">

<head>
    <meta charset="utf-8" />
    <base id="base">
    <script src="/assets/js/config.js"></script>
    <link rel="apple-touch-icon" sizes="76x76" href="assets/img/logo.png">
    <link rel="icon" type="image/png" href="assets/img/logo.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
        name='viewport' />
    <title>دکتر تجویز</title>
    <script src="assets/js/core/jquery.3.2.1.min.js" type="text/javascript"></script>
    <!--     Fonts and icons     -->
    <link rel="stylesheet" href="assets/fonts/font-awesome/css/font-awesome.min.css" />
    <!-- CSS Files -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/css/now-ui-kit.css" rel="stylesheet" />
    <link href="assets/css/plugins/owl.carousel.css" rel="stylesheet" />
    <link href="assets/css/plugins/owl.theme.default.min.css" rel="stylesheet" />
    <link href="assets/css/main.css" rel="stylesheet" />
    <link href="assets/css/index.css" rel="stylesheet" />
    <style>
        /* @media screen and (max-width:1920px) {
            #searchinput {
                visibility: hidden;
            }
        } */

        @media screen and (max-width : 800px) {
            #searchinput {
                max-width: 100%;
            }
        }
        .button{
  text-decoration: none;
  text-transform: capitalize;
  background: #fff;
  color: #000;
  position: relative;
  top: 0;
  left: 0;
  padding: 20px 40px;
  border-radius: 10px;
  box-shadow: 0 10px 10px rgba(0, 0, 0, 0.2);
  transform: translateY(-3px);
  transition: all .5s ease-in-out;
}
.button:after{
  content: "";
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  border-radius: 10px;
  z-index: -1;
  transition: all .5s;
}
.button:after{
  background:#f37335;
}
.button:hover:after{
  transform: scaleX(1.4) scaleY(1.6);
  opacity: 0;
}
.spinner {
  --size: 62px;

  width: var(--size);
  height: var(--size);

  border-radius: 50%;
  perspective: 800px;
}
.inner {
  position: absolute;
  box-sizing: border-box;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  border: 3px solid transparent;
}
.inner.one {
  left: 0;
  top: 0;
  animation: rotate-one 1s linear infinite;
  border-bottom: 3px solid #2cfffe;
}

.inner.two {
  right: 0;
  top: 0;
  animation: rotate-two 1s linear infinite;
  border-right: 3px solid #fcc10f;
}

.inner.three {
  right: 0;
  bottom: 0;
  animation: rotate-three 1s linear infinite;
  border-top: 3px solid #ec1b60;
}
@keyframes rotate-one {
  0% {
    transform: rotateX(35deg) rotateY(-45deg) rotateZ(0deg);
  }
  100% {
    transform: rotateX(35deg) rotateY(-45deg) rotateZ(360deg);
  }
}
@keyframes rotate-two {
  0% {
    transform: rotateX(50deg) rotateY(10deg) rotateZ(0deg);
  }
  100% {
    transform: rotateX(50deg) rotateY(10deg) rotateZ(360deg);
  }
}
@keyframes rotate-three {
  0% {
    transform: rotateX(35deg) rotateY(55deg) rotateZ(0deg);
  }
  100% {
    transform: rotateX(35deg) rotateY(55deg) rotateZ(360deg);
  }
}
    </style>
</head>

<body class="index-page sidebar-collapse">

    <!-- header-responsive -->
    <%- include('header-responsive.ejs'); -%>
    <!-- header-responsive -->

    <div class="wrapper default">

        <!-- header -->
        <%- include('header.ejs'); -%>
        <!-- header -->

        <!-- main -->
        <main class="search-page default">
            <div class="container">
                <div class="row">
                    <div class="col-12 col-sm-12 col-md-12 col-lg-12 order-2">
                        <div class="breadcrumb-section default">
                            <ul class="breadcrumb-list">
                                <% if(type=="category") { %>
                                <li>
                                    <a href="#">
                                        <span>نوبت دهی</span>
                                    </a>
                                </li>
                                <% } else {  %>
                                <li>
                                    <a href="#">
                                        <span>نوبت دهی</span>
                                    </a>
                                </li>
                                <li><a href="/category/<%= category%>?city=all"><%= category.split('-').join(' ') %></a>
                                </li>

                                <div>
                                    <select id="sel" onchange="javascript:handleSelect(this)">
                                        <option selected disabled>فیلتر بر اساس شهر</option>
                                        <option value="all">همه</option>
                                        <option value="ایلام">ایلام</option>
                                        <option value="کرمانشاه">کرمانشاه</option>
                                    </select>
                                    <script type="text/javascript">
                                        var str1 = window.location.href;
                                        var pattern = "city="
                                        var str2 = str1.substr(str1.indexOf(pattern) + pattern.length,
                                            str1.length);
                                        str2 = decodeURIComponent(str2);
                                        if (str2 !== "all") {
                                            document.getElementById('sel').value = str2;
                                        }

                                    </script>
                                    <script type="text/javascript">
                                        function handleSelect(elm) {
                                            window.location = window.location.href.split('?')[0] + "?city=" + elm.value;
                                        }
                                    </script>
                                </div>
                                <% } %>
                            </ul>
                        </div>
                        <% if(type=="doc") { %>
                        <span><p id="select-category">لطفا دکتر خود را از لیست زیر انتخاب کنید</p>
                            <a onclick="getdoctor()" style="float: left;" data-toggle="modal"
                            data-target="#exampleModalLong" class="btn btn-info button">به من پیشنهاد بده</a></span>
                        <!-- modal -->
                        <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog"
                        aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLongTitle"
                                        style="margin-top: 24px;">پیشنهاد پزشکان</h5>
                                    <button type="button" class="close" data-dismiss="modal"
                                        aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div id="loadingdiv">
                                        <div class="spinner" style="position: relative;right: 40%;" >
                                            <div class="inner one"></div>
                                            <div class="inner two"></div>
                                            <div class="inner three"></div>
                                          </div>
                                        <p style="word-wrap: break-word;text-align: center;">
                                            دکتر تجویز در حال یافتن مناسب ترین دکتر برای شماست.
                                        </p>
                                    </div>
                                    <div id="noresult" style="display: none;">
                                        <p style="word-wrap: break-word;text-align: center;">
                                           موردی یافت نشد.
                                        </p> 
                                    </div>
                                    <div id="result" style="display: none;text-align-last: center;">
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary"
                                        data-dismiss="modal">خودم انتخاب میکنم</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- modal -->
                    <script>
                        function requesttoserver(){
                            $.ajax({
                                type: "GET",
                                url: '/suggestdoctor?cat='+"<%=category%>",
                                data: $(this).serialize(),
                                success: function(response){
                                    if(response.data=="nothing"){
                                        document.getElementById("loadingdiv").style.display="None";
                                        document.getElementById("result").style.display="none";
                                        document.getElementById("noresult").style.display="block";
                                    }
                                    else{
                                        $('#result').empty();
                                        document.getElementById("loadingdiv").style.display="None";
                                        document.getElementById("result").style.display="block";
                                        document.getElementById("noresult").style.display="None";
                                        link=document.createElement("a");
                                        link.href="/category/"+response.data.categories[0].split(" ").join('-')+"/"+response.data.name.split(" ").join('-');
                                        img=document.createElement("img");
                                        img.src=response.data.image
                                        img.className="rounded-circle";
                                        img.style="min-height: 128px;min-width: 128px;max-width: 128px;max-height: 128px;background: transparent"
                                        link.appendChild(img);
                                        p=document.createElement("p");
                                        p2=document.createElement("p");
                                        p.innerHTML=response.data.name;
                                        p2.innerHTML="سابقه: "+response.data.background+" سال";
                                        if(response.data.rate!=0){
                                            div=document.createElement("div");
                                            div.innerHTML='<span style="color: black;" class="points"><i class="fa fa-star" aria-hidden="true" style="color: #fb0;"></i>'+response.data.rate+'</span>';
                                            link.appendChild(div)
                                        }
                                        link.appendChild(p);
                                        link.appendChild(p2);
                                        a2=document.createElement("a");
                                        a2.className="btn btn-info";
                                        a2.innerHTML="برو به صفحه پزشک"
                                        link.appendChild(a2);
                                        document.getElementById("result").appendChild(link)
                                    }
                                }
                            });
                        }
                        function turnonloading(){
                            document.getElementById("noresult").style.display="none";
                            document.getElementById("result").style.display="none";
                            document.getElementById("loadingdiv").style.display="block";
                        }
                        function getdoctor(){
                            turnonloading();
                            setTimeout(requesttoserver,3000);
                        }
                    </script>
                        <% } else{ %>
                        <div class="row">
                            <div class="col-12">
                                <p id="select-category">لطفا تخصص مورد نیاز خود را از لیست زیر انتخاب کنید</p>
                                <input oninput="fastsearch()" class="form-control" type="text"  name="searchinput" id="searchinput" style="margin-bottom: 16px; max-width: 30%;border-width: 2px;border-color: black;background-color: white;" placeholder="جستجوی تخصص">
                            </div>
                            <div class="col">
                               
                                
                            </div>
                            
                        </div>
                        <% } %>
                        <div class="listing default">
                            <div class="tab-content default text-center">
                                <div class="tab-pane active" id="related" role="tabpanel" aria-expanded="true">
                                    
                                    <div class="container">
                                        <ul id="uilist" class="row listing-items">
                                            <% if(Objects.length!=0) { %>
                                            <% for(let i =0 ;i < Objects.length ; i++) { %>
                                                <% if(category=="") { %>
                                            <li name="objects" data-name="<%= Objects[i].name %>" class="box hvr-grow-shadow">
                                               
                                                <a
                                                    href="<%= "category"+  category.split(' ').join('-') + "/" + Objects[i].name.split(' ').join('-') +"?city=all" %>">
                                                    <div style="border-width: 2px;
                                                    font-weight: 400;
                                                    font-size: 0.8571em;
                                                    line-height: 1.35em;
                                                    margin: 5px 1px;
                                                    border: none;
                                                    border-radius: 0.1875rem;
                                                    padding: 11px 22px;
                                                    cursor: pointer;
                                                    background-color:#FAFAFA;
                                                    max-width: 172px;
                                                    color: #FFFFFF;" style="border-radius: 20px;">
                                                        <div style="height:auto; width: auto;">
                                                            <img src="<%= Objects[i].image %>"
                                                                style="background: transparent; min-height: 128px;min-width: 128px; max-width: 128px; max-height: 128px;"
                                                                onerror="this.src='assets/img/altimage.png'"
                                                                alt="not found">
                                                        </div>
                            
                                                        <p class="card-text text-slate font-weight-bold text-14 mt-4"
                                                            style="color: #1e3e72;">
                                                            <%= Objects[i].name %>
                                                        </p>
                                                    </div>
                                                </a>
                                            </li>
                                                <% } else {  %>
                                                    <li class="box hvr-grow-shadow">
                                                <a
                                                    href="<%= "category/"+ category.split(' ').join('-') + "/" + Objects[i].name.split(' ').join('-') %>">
                                                    <div style="border-width: 2px;
                                                    font-weight: 400;
                                                    font-size: 0.8571em;
                                                    line-height: 1.35em;
                                                    margin: 5px 1px;
                                                    border: none;
                                                    border-radius: 0.1875rem;
                                                    padding: 11px 22px;
                                                    cursor: pointer;
                                                    background-color:#FAFAFA;
                                                    max-width: 172px;
                                                    color: #FFFFFF;" style="border-radius: 20px;">
                                                        <div style="height:auto; width: auto;">
                                                            <img src="<%= Objects[i].image %>"
                                                                style="background: transparent; min-height: 128px;min-width: 128px; max-width: 128px; max-height: 128px;"
                                                                onerror="this.src='assets/img/altimage.png'"
                                                                alt="not found">
                                                        </div>
                                                        <%if(Objects[i].countofvotes==0&&Objects[i].rate==0) { }else{ %>
                                                        <span style="color: black;" class="points"><i class="fa fa-star" aria-hidden="true" style="color: #fb0;"></i> <%= Objects[i].rate %></span>
                                                        <% } %>
                                                        <p class="card-text text-slate font-weight-bold text-14 mt-4"
                                                            style="color: #1e3e72;">
                                                            <%= Objects[i].name %>
                                                        </p>
                                                    </div>
                                                </a>
                                               
                                            </li>
                                            <% } %>
                                            <% } %>
                                            <% } else { %>
                                                <div class="c-message-light c-message-light--info c-listing-not-found__message">
                                                    <div class="c-message-light__justify">
                                                        <p>
                                                            موردی جهت نمایش وجود ندارد.</p>
                                                    </div>
                                                </div>
                                            <% } %>
                                        </ul>
                                    </div>
                                </div>
                                <div class="tab-pane" id="most-view" role="tabpanel" aria-expanded="false">
                                    <div class="container">
                                        <ul class="row listing-items">
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <!-- main -->

        <!-- footer -->
        <%- include('footer.ejs'); -%>
        <!-- footer -->

    </div>
</body>
<!--   Core JS Files   -->

<script src="assets/js/core/popper.min.js" type="text/javascript"></script>
<script src="assets/js/core/bootstrap.min.js" type="text/javascript"></script>
<!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
<script src="assets/js/plugins/bootstrap-switch.js"></script>
<!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
<script src="assets/js/plugins/nouislider.min.js" type="text/javascript"></script>
<!--  Plugin for the DatePicker, full documentation here: https://github.com/uxsolutions/bootstrap-datepicker -->
<script src="assets/js/plugins/bootstrap-datepicker.js" type="text/javascript"></script>
<!-- Share Library etc -->
<script src="assets/js/plugins/jquery.sharrre.js" type="text/javascript"></script>
<!-- Control Center for Now Ui Kit: parallax effects, scripts for the example pages etc -->
<script src="assets/js/now-ui-kit.js" type="text/javascript"></script>
<!--  CountDown -->
<script src="assets/js/plugins/countdown.min.js" type="text/javascript"></script>
<!--  Plugin for Sliders -->
<script src="assets/js/plugins/owl.carousel.min.js" type="text/javascript"></script>
<!--  Jquery easing -->
<script src="assets/js/plugins/jquery.easing.1.3.min.js" type="text/javascript"></script>
<!--  LocalSearch -->
<script src="assets/js/plugins/JsLocalSearch.js" type="text/javascript"></script>
<!-- Main Js -->
<script src="assets/js/main.js" type="text/javascript"></script>

<script>
    function fastsearch(){
        value=document.getElementById("searchinput").value;
        document.getElementsByName("objects").forEach(function(doc){
            if(!doc.dataset.name.includes(value)){
                doc.style.display="none"
            }
            else{
                doc.style.display=""
            }
        })
    }
</script>

</html>